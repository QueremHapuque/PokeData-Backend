from flask import Flask, make_response, jsonify
import json
import pandas as pd

from pokeColuna import pokeId

app = Flask(__name__)
app.config['JSON_SORT_KEYS'] = False

dsP = pd.read_parquet('pokemon.parquet')
dsP = pokeId(dsP)
print(dsP)

ds = open('pokemon.json')
dsjson = json.load(ds)

@app.route('/pokeinfo/<string:index>', methods=['GET'])
def aldataofpokemon(index):
    dados = [
        {
            "name": dsjson['name'][index],
            "typing": dsjson['typing'][index],
            "primary_color": dsjson['primary_color'][index],
            "height": dsjson['height'][index],
            "weight": dsjson['weight'][index],
            "gen_introduced": dsjson['gen_introduced'][index],
            "hp": dsjson['hp'][index],
            "attack": dsjson['attack'][index],
            "defense": dsjson['defense'][index],
            "speed": dsjson['speed'][index],
            "special_attack": dsjson['special_attack'][index],
            "special_defense": dsjson['special_defense'][index],
            "abilities": dsjson['abilities'][index]
        }
    ]

    return make_response(
        jsonify(dados)    
    )


@app.route('/vantagem/<string:tipo>', methods=['GET'])
def alladvantageofpokemon(tipo):

    listaMultplicador = []
    listaIndex = []
    contador = 0
    ataq = 'fire_attack_effectiveness'
    maior = 0
    tipo1 = ''
    tipo2 = ''
    rep = ataq.replace('fire', tipo)
    for mult in dsjson[rep]:
        if int(dsjson[rep][mult]) >= maior:
            maior = int(dsjson[rep][mult])
            listaMultplicador.append(maior)
            listaIndex.append(mult)

    for i in range(len(listaIndex)):
        contador -= 1
        if tipo1 == '':
            tipo1 = dsjson['typing'][listaIndex[contador]]
        if tipo1 != dsjson['typing'][listaIndex[contador]]:
            tipo2 = dsjson['typing'][listaIndex[contador]]
            break
    vantagens = [
        {
            "type_1": tipo1,
            "type_2": tipo2
        }
    ]
    return make_response(
        jsonify(vantagens)
    )

app.run()
